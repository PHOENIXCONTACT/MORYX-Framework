@if (!isLoading()) {
  <div class="overall-container">
    @if (jobCollection().length) {
      <mat-accordion
    [ngStyle]="{
      'background-image':
        'url(' +
        environment.assets +
        'assets/moryx_transparent_colored.png' +
        ')'
    }"
        class="process-list"
        >
        @for (job of jobCollection(); track job.model.id)
          {
          <mat-expansion-panel
            class="job"
            >
            <mat-expansion-panel-header
              [collapsedHeight]="'70px'"
              [expandedHeight]="'70px'"
              >
              @if (job.model.productionJob) {
                <div class="job-container">
                  <div class="job-details-container">
                    @if (job.model.isWaiting) {
                      <mat-icon class="icon-primary-color"
                        >precision_manufacturing</mat-icon
                        >
                      }
                      @if (job.model.isRunning) {
                        <mat-icon class="icon-accent-color"
                          >precision_manufacturing</mat-icon
                          >
                        }
                        <div class="job-details">
                          <span
                            >{{ TranslationConstants.JOBS.ORDER | translate }}:
                            {{ getOrderNumber(job.model) }}</span
                            >
                            <span
                              >{{ TranslationConstants.JOBS.OPERATION | translate }}:
                              {{ getOperationNumber(job.model) }}</span
                              >
                            </div>
                            <div class="job-details">
                              <span
                                >{{ TranslationConstants.JOBS.ID | translate }}:
                                {{ job.model.id }}</span
                                >
                                <span
                                  >{{ TranslationConstants.JOBS.STATE | translate }}:
                                  {{ job.model.displayState }}</span
                                  >
                                </div>
                                <div class="job-details">
                                  <span
                                    >{{ TranslationConstants.JOBS.AMOUNT | translate }}:
                                    {{ job.model.productionJob?.amount }}</span
                                    >
                                    <span
                                      >{{ TranslationConstants.JOBS.PRODUCT | translate }}:
                                      {{ job.model.productionJob?.productIdentity }}</span
                                      >
                                    </div>
                                    <div class="job-details">
                                      <span
                                        >{{ TranslationConstants.JOBS.RUNNING | translate }}:
                                        {{ job.model.productionJob?.runningCount }}</span
                                        >
                                        <span
                                          >{{ TranslationConstants.JOBS.WORKPLAN | translate }}:
                                          {{ job.model.workplan }}</span
                                          >
                                        </div>
                                        <div class="job-details">
                                          <span
                                            >{{ TranslationConstants.JOBS.SUCCESS | translate }}:
                                            {{ job.model.productionJob?.successCount }}</span
                                            >
                                            <span
                                              >{{ TranslationConstants.JOBS.REWORKED | translate }}:
                                              {{ job.model.productionJob?.reworkedCount }}</span
                                              >
                                            </div>
                                            <div>
                                              <span
                                                >{{ TranslationConstants.JOBS.FAILED | translate }}:
                                                {{ job.model.productionJob?.failureCount }}</span
                                                >
                                              </div>
                                            </div>
                                            <div class="job-progress">
                                              <mat-progress-bar
                                                mode="determinate"
                                                value="100"
                                                class="progress-accent-color"
                                                [ngStyle]="{ width: job.productionSuccessPercent + '%' }"
                                                >
                                              </mat-progress-bar>
                                              <mat-progress-bar
                                                mode="determinate"
                                                value="100"
                                                class="progress-warn-color"
                                                [ngStyle]="{ width: job.productionScrapPercent + '%' }"
                                                >
                                              </mat-progress-bar>
                                              <mat-progress-bar
                                                mode="determinate"
                                                value="100"
                                                [ngStyle]="{ width: job.productionRunningPercent + '%' }"
                                              ></mat-progress-bar>
                                              <mat-progress-bar
                                                mode="determinate"
                                                value="0"
                                                [ngStyle]="{ width: job.productionResidualPercent + '%' }"
                                              ></mat-progress-bar>
                                            </div>
                                          </div>
                                        } @else {
                                          <div class="job-container">
                                            <div class="job-details-container">
                                              @if (job.model.isWaiting) {
                                                <mat-icon class="icon-primary-color"
                                                  >settings</mat-icon
                                                  >
                                                }
                                                @if (job.model.isRunning) {
                                                  <mat-icon class="icon-accent-color"
                                                    >settings</mat-icon
                                                    >
                                                  }
                                                  <span class="job-details">Id: {{ job.model.id }}</span>
                                                  <span class="job-details">State: {{ job.model.displayState }}</span>
                                                  <span class="job-details"
                                                    >{{ TranslationConstants.JOBS.WORKPLAN | translate }}:
                                                    {{ job.model.workplan }}</span
                                                    >
                                                  </div>
                                                  <div class="job-progress">
                                                    <mat-progress-bar
                                                      mode="determinate"
                                                      value="100"
                                                      class="progress-accent-color"
                                                      [ngStyle]="{ width: job.setupCompletedPercent + '%' }"
                                                      >
                                                    </mat-progress-bar>
                                                    <mat-progress-bar
                                                      mode="determinate"
                                                      value="100"
                                                      [ngStyle]="{ width: job.setupRunningPercent + '%' }"
                                                    ></mat-progress-bar>
                                                    <mat-progress-bar
                                                      mode="determinate"
                                                      value="0"
                                                      [ngStyle]="{ width: job.setupResidualPercent + '%' }"
                                                    ></mat-progress-bar>
                                                  </div>
                                                </div>
                                              }
                                            </mat-expansion-panel-header>
                                            @if (job.model.setupJob) {
                                              <div class="job-details-setup-container">
                                                @for (step of job.model.setupJob.steps; track step) {
                                                  <div
                                                    class="job-details-setup-steps"
                                                    >
                                                    @if (step.state === 'Completed') {
                                                      <mat-icon class="icon-primary-color"
                                                        >check_circle</mat-icon
                                                        >
                                                      }
                                                      @if (step.state === 'Running') {
                                                        <mat-icon class="icon-accent-color"
                                                          >build_circle</mat-icon
                                                          >
                                                        }
                                                        @if (step.state === 'Initial') {
                                                          <mat-icon>build_circle</mat-icon>
                                                        }
                                                        {{ step.name }}
                                                      </div>
                                                    }
                                                  </div>
                                                }
                                                <app-processes [job]="job"></app-processes>
                                                <mat-action-row>
                                                  <button
                                                    mat-flat-button
                                                    (click)="onComplete(job.model)"
                                                    [disabled]="!job.model.canComplete"
                                                    >
                                                    {{ TranslationConstants.JOBS.COMPLETE | translate }}
                                                  </button>
                                                  <button
                                                    mat-flat-button
                                                    (click)="onAbort(job.model)"
                                                    [disabled]="!job.model.canAbort"
                                                    >
                                                    {{ TranslationConstants.JOBS.ABORT | translate }}
                                                  </button>
                                                </mat-action-row>
                                              </mat-expansion-panel>
                                            }
                                          </mat-accordion>
                                        } @else {
                                          <empty-state
                                            header="{{ TranslationConstants.JOBS.EMPTY_STATE_HEADER | translate }}"
                                            message="{{ TranslationConstants.JOBS.EMPTY_STATE_TEXT | translate }}"
                                          ></empty-state>
                                        }
                                      </div>
                                    } @else {
                                      <div class="overall-container loading">
                                        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
                                      </div>
                                    }


