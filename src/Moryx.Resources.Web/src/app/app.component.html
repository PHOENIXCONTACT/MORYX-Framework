<mat-sidenav-container class="resources">
  <mat-sidenav opened role="navigation" mode="side" class="resources-tree" [disableClose]="true">
    <div class="resources-side-bar" (click)="clickContainer($event)">
      <mat-toolbar
        *ngIf="!selected; else selectedToolbar"
        color="primary"
        [ngStyle]="{ 'background-image': 'url(' + resourceToolbarImage + ')' }"
      >
        <mat-toolbar-row>
          <button mat-icon-button aria-label="Disabled Menu" disabled>
            <mat-icon></mat-icon>
          </button>
          <span class="resources-toolbar-spacer"></span>
          <button
            type="button"
            (click)="onReload()"
            mat-icon-button
            aria-label="Reload resources"
            [matTooltip]="TranslationConstants.SHARED.RELOAD | translate"
            matTooltipShowDelay="500"
          >
            <mat-icon>sync</mat-icon>
          </button>
        </mat-toolbar-row>

        <mat-toolbar-row>
          <button mat-icon-button aria-label="Spacer" disabled="true">
            <mat-icon></mat-icon>
          </button>
          <span>{{ TranslationConstants.APP.RESOURCES | translate }}</span>
        </mat-toolbar-row>
      </mat-toolbar>

      <mat-menu #contextMenu="matMenu">
        <ng-template matMenuContent let-id="id">
          <button
            mat-menu-item
            [disabled]="
              !hasPermission(Permissions.CAN_REMOVE_RESOURCE) ||
              editService.edit
            "
            (click)="onDelete(id)"
          >
            <mat-icon>delete_forever</mat-icon>
            <span>{{ TranslationConstants.SHARED.DELETE | translate }}</span>
          </button>
          <button
            [disabled]="
              !hasPermission(Permissions.CAN_EDIT_RESOURCE) || editService.edit
            "
            mat-menu-item
            (click)="onSelectAndEdit(id)"
          >
            <mat-icon>edit</mat-icon>
            <span>{{ TranslationConstants.SHARED.EDIT | translate }}</span>
          </button>
        </ng-template>
      </mat-menu>
      <!-- A hidden div is created to set the position of the menu-->
      <div
        style="visibility: hidden; position: fixed"
        [style.left]="menuTopLeftPosition().x"
        [style.top]="menuTopLeftPosition().y"
        [matMenuTriggerFor]="contextMenu"
      ></div>

      <mat-tree
        class="resources-tree-contents"
        [dataSource]="dataSource"
        [treeControl]="treeControl"
      >
        <mat-tree-node
          *matTreeNodeDef="let node"
          matTreeNodePadding
          [matTreeNodePaddingIndent]="10"
          (click)="selectResource(node.id)"
          (contextmenu)="openContextMenuByClicking($event, node.id)"
          (press)="openContextMenuByPressing($event, node.id)"
          class="resources-tree-item"
          [ngClass]="{
            'moryx-selected': selected?.id == node.id,
            'italic': !(node.name && node.name.trim())
          }"
        >
          <button mat-icon-button title="Disabled toggle" disabled></button>
          {{ (node.name && node.name.trim()) ? node.name : TranslationConstants.APP.NO_NAME | translate }}
        </mat-tree-node>
        <mat-tree-node
          *matTreeNodeDef="let node; when: hasChild"
          matTreeNodePadding
          [matTreeNodePaddingIndent]="10"
          (click)="selectResource(node.id)"
          (contextmenu)="openContextMenuByClicking($event, node.id)"
          (press)="openContextMenuByPressing($event, node.id)"
          class="resources-tree-item"
          [ngClass]="{
            'moryx-selected': selected?.id == node.id,
            'italic': !(node.name && node.name.trim())
          }"
        >
          <button
            mat-icon-button
            matTreeNodeToggle
            [attr.aria-label]="'Toggle ' + node.name"
            type="button"
          >
            <mat-icon class="mat-icon-rtl-mirror">
              {{
                treeControl.isExpanded(node) ? "expand_more" : "chevron_right"
              }}
            </mat-icon>
          </button>
          {{ (node.name && node.name.trim()) ? node.name : TranslationConstants.APP.NO_NAME | translate }}
        </mat-tree-node>
      </mat-tree>
    </div>

    <button
      *ngIf="!selected"
      mat-fab
      color="primary"
      class="resources-add-button"
      type="button"
      aria-label="Add resource"
      (click)="onAdd()"
      [disabled]="!hasPermission(Permissions.CAN_ADD_RESOURCE)"
      [matTooltip]="TranslationConstants.SHARED.ADD | translate"
      matTooltipShowDelay="500"
    >
      <mat-icon>add</mat-icon>
    </button>
  </mat-sidenav>

  <mat-sidenav-content role="main">
    <router-outlet></router-outlet>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #selectedToolbar>
  <mat-toolbar
    [ngStyle]="{ 'background-image': 'url(' + resourceToolbarImage + ')' }"
    class="resources-toolbar"
  >
    <mat-toolbar-row>
      <button
        type="button"
        (click)="onDeselect()"
        mat-icon-button
        aria-label="Unselect resource"
        [matTooltip]="TranslationConstants.SHARED.CANCEL | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">close</span>
      </button>
      <span class="resources-toolbar-spacer"></span>
      <button
        *ngIf="!editService.edit"
        type="button"
        (click)="onEdit()"
        [disabled]="!hasPermission(Permissions.CAN_EDIT_RESOURCE)"
        mat-icon-button
        aria-label="Add child"
        [matTooltip]="TranslationConstants.SHARED.EDIT | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">edit</span>
      </button>
      <button
        *ngIf="!editService.edit"
        type="button"
        (click)="onAdd()"
        [disabled]="!hasPermission(Permissions.CAN_ADD_RESOURCE)"
        mat-icon-button
        aria-label="Add child"
        [matTooltip]="TranslationConstants.SHARED.ADD_CHILD | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">masked_transitions_add</span>
      </button>
      <button
        *ngIf="!editService.edit"
        type="button"
        (click)="onDelete(selected?.id)"
        [disabled]="!hasPermission(Permissions.CAN_REMOVE_RESOURCE)"
        mat-icon-button
        aria-label="Delete resource"
        [matTooltip]="TranslationConstants.SHARED.DELETE | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">delete</span>
      </button>

      <button
        *ngIf="editService.edit"
        type="button"
        (click)="onSave()"
        mat-icon-button
        aria-label="Save resource"
        [matTooltip]="TranslationConstants.SHARED.SAVE | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">save</span>
      </button>
      <button
        *ngIf="editService.edit"
        type="button"
        (click)="onCancelEditing()"
        mat-icon-button
        aria-label="Cancel editing resource"
        [matTooltip]="TranslationConstants.SHARED.CANCEL | translate"
        matTooltipShowDelay="500"
      >
        <span class="material-symbols-outlined">cancel</span>
      </button>
    </mat-toolbar-row>

    <mat-toolbar-row></mat-toolbar-row>
  </mat-toolbar>
</ng-template>
